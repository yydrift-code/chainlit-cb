# Caddyfile for realtime-demo.renovavision.tech
# This configuration proxies requests to your Docker container running on port 8888

realtime-demo.renovavision.tech {
	# Reverse proxy to your Docker container
	reverse_proxy 0.0.0.0:8888 {
		# Health checks to ensure the backend is available
		health_uri /health
		health_interval 30s
		health_timeout 10s
		health_passes 2
		health_fails 3
		
		# Load balancing (single backend in this case)
		lb_policy round_robin
		
		
		# Headers to preserve client information
		header_up Host {host}
		header_up X-Real-IP {remote}
		
		# WebSocket support for realtime features
		header_up Connection {>Connection}
		header_up Upgrade {>Upgrade}
		header_up Sec-WebSocket-Key {>Sec-WebSocket-Key}
		header_up Sec-WebSocket-Version {>Sec-WebSocket-Version}
		header_up Sec-WebSocket-Extensions {>Sec-WebSocket-Extensions}
		header_up Sec-WebSocket-Protocol {>Sec-WebSocket-Protocol}
	}
	
	# Logging configuration
	log {
		output file /var/log/caddy/realtime-demo.log
		format json
		level INFO
	}
	

}

# Optional: Redirect www subdomain to main domain
www.realtime-demo.renovavision.tech {
	redir https://realtime-demo.renovavision.tech{uri} permanent
}
